<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your Shopping Cart</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
  </head>
  <body>
    <header class="header">
      <div class="logo">
        <a href="{{ url_for('main.index') }}">
          <img src="{{ url_for('static', filename='logo.jpg') }}" alt="Logo" />
        </a>
      </div>
      <div class="search-bar">
        <form action="{{ url_for('main.index') }}" method="GET">
          <input
            type="text"
            name="search"
            placeholder="Search for products..."
          />
          <button type="submit">Search</button>
        </form>
      </div>
      <div class="user-options">
        {% if current_user.is_authenticated %}
        <a href="{{ url_for('cart.view_cart') }}">Cart</a>
        <div class="dropdown">
          <button class="dropdown-btn">☰</button>
          <div class="dropdown-content">
            <a href="{{ url_for('orders.view_orders') }}">My Orders</a>
            <a href="{{ url_for('main.my_products') }}">My Products</a>
            <a href="{{ url_for('auth.logout') }}">Logout</a>
          </div>
        </div>
        {% else %}
        <a href="{{ url_for('auth.login') }}">Login</a>
        <a href="{{ url_for('auth.register') }}">Register</a>
        {% endif %}
      </div>
    </header>

     <div id="recommendations-container">
      {% if similar_products %}
      <section class="recommendations-section">
        <div class="section-header">
          <h2>✨ Special for You</h2>
          <p class="subtitle">Selected based on your favorite brands</p>
          <p class="subtitle">
            Recommendations generated by AI based on similarities with other customers.
          </p>
        </div>
        <div class="product-gallery">
          {% for product in similar_products %}
          <div class="product-card" data-product-id="{{ product.id }}">
            <img
              src="{{ url_for('static', filename=product.image_url) }}"
              alt="{{ product.name }}"
            />
            <div class="product-details">
              <h2>{{ product.name }}</h2>
              <p class="brand">{{ product.brand }}</p>
              <p class="price">${{ product.price }}</p>
              <p class="description">{{ product.description }}</p>
              {% if product.color or product.material or product.purpose %}
              <div class="product-specs">
                {% if product.color %}<span class="spec">Color: {{ product.color }}</span>{% endif %}
                {% if product.material %}<span class="spec">Material: {{ product.material }}</span>{% endif %}
                {% if product.purpose %}<span class="spec">Purpose: {{ product.purpose }}</span>{% endif %}
              </div>
              {% endif %}
              {% if current_user.is_authenticated %}
              <form
                action="{{ url_for('cart.add_to_cart', product_id=product.id) }}"
                method="POST"
                class="add-to-cart-form"
                data-product-id="{{ product.id }}"
              >
                <button type="submit" class="btn-add-to-cart">Add to Cart</button>
              </form>
              {% else %}
              <p class="login-prompt">
                <a href="{{ url_for('auth.login') }}">Log in to add to cart</a>
              </p>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </section>
      {% endif %}
      </div>

    <div class="cart-container">
      <h1>Your Shopping Cart</h1>
      {% if cart_items %}
      <table class="cart-table">
        <thead>
          <tr>
            <th>Image</th>
            <th>Product</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Total</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for item in cart_items %}
          <tr>
            <td>
              <img
                src="{{ url_for('static', filename=item.product.image_url) }}"
                alt="{{ item.product.name }}"
              />
            </td>
            <td>{{ item.product.name }}</td>
            <td>${{ item.product.price }}</td>
            <td>
              <form
                action="{{ url_for('cart.update_quantity', item_id=item.id) }}"
                method="POST"
              >
                <input
                  type="number"
                  name="quantity"
                  value="{{ item.quantity }}"
                  min="1"
                  class="quantity-input"
                />
                <button type="submit" class="btn-update">Update</button>
              </form>
            </td>
            <td>${{ item.product.price * item.quantity }}</td>
            <td>
              <form
                action="{{ url_for('cart.remove_item', item_id=item.id) }}"
                method="POST"
              >
                <button type="submit" class="btn-remove">Remove</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="cart-summary">
        <p>Total: ${{ "%.2f"|format(total_price) }}</p>
        <a href="{{ url_for('checkout.view_checkout') }}" class="checkout-btn"
          >Proceed to Checkout</a
        >
      </div>
      {% else %}
      <p class="empty-cart">Your cart is empty.</p>
      {% endif %}
    </div>
  </body>
</html>
